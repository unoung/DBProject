create or replace NONEDITIONABLE PACKAGE BODY PKG_HOST AS
	
	-- 호스트 생성
  PROCEDURE PROC_INS_HOST(
	 IN_HOST_NUM		IN		VARCHAR2		-- 호스트 사업자 번호
	,IN_HOST_NAME		IN		VARCHAR2		-- 호스트 이름
	,O_ERRCODE			OUT		VARCHAR2
	,O_ERRMSG			OUT		VARCHAR2
  ) AS
		V_NEW_HOST_ID		CHAR(4);
		
  BEGIN
    
	-- 호스트 ID 생성
	SELECT 'H' || TO_CHAR(NVL(TO_NUMBER(SUBSTR(MAX(HOST_ID), 2, 3)), 0) +1, 'FM000')
	INTO V_NEW_HOST_ID
	FROM HOST_TBL
	;
	
	-- GRP_ID와 COM_ID는 고정
	INSERT INTO HOST_TBL(HOST_ID, HOST_NUM, HOST_NAME, GRP_ID, HOST_LVL) 
	VALUES(V_NEW_HOST_ID, IN_HOST_NUM, IN_HOST_NAME, 'GRP004', 'COM002')
	;
	
	EXCEPTION
	WHEN OTHERS THEN
	O_ERRCODE := SQLCODE;
	O_ERRMSG := SQLERRM;
	ROLLBACK;
	
  END PROC_INS_HOST;
  
  
	-- 호스트 조회
  PROCEDURE PROC_SEL_HOST(
	  IN_HOST_ID		IN		VARCHAR2			-- 호스트 아이디
	 ,IN_HOST_NUM		IN		VARCHAR2			-- 호스트 사업자 번호
	 ,IN_HOST_NAME 		IN		VARCHAR2			-- 호스트 이름
	 ,IN_HOST_LVL		IN		VARCHAR2			-- 호스트 등급
	 ,O_CUR				OUT		SYS_REFCURSOR
  ) AS
  BEGIN
    
	OPEN O_CUR FOR
		SELECT T1.HOST_ID, T1.HOST_NUM, T1.HOST_NAME, T2.COM_VAL, T1.HOST_LVL
		FROM HOST_TBL T1, COMMONS_TBL T2
		WHERE T1.HOST_LVL = T2.COM_ID
		AND T2.GRP_ID = 'GRP004'
		AND T1.HOST_ID LIKE '%'|| IN_HOST_ID || '%'			
		AND T1.HOST_NUM LIKE '%'|| IN_HOST_NUM ||'%'
		AND T1.HOST_NAME LIKE '%'|| IN_HOST_NAME ||'%'
		AND T1.HOST_LVL LIKE '%'|| IN_HOST_LVL || '%'
		;
	
  END PROC_SEL_HOST;
  
  
  PROCEDURE PROC_UP_HOST(						
	  IN_HOST_ID		IN		VARCHAR2		-- 호스트 아이디
	 ,IN_HOST_NUM		IN		VARCHAR2		-- 호스트 사업자 번호
	 ,IN_HOST_NAME		IN		VARCHAR2		-- 호스트 이름
	 ,O_ERRCODE			OUT		VARCHAR2
	 ,O_ERRMSG			OUT		VARCHAR2
  ) AS
  
	V_HOST_ID_CNT			NUMBER(1);
	HOST_ID_EXCEPTION		EXCEPTION;
	
  BEGIN
    -- 호스트 테이블에서 입력받은 IN_HOST_ID 값을 HOST_ID 로 가지는 데이터의 개수를 센다.
	SELECT COUNT(HOST_ID)
	INTO V_HOST_ID_CNT
	FROM HOST_TBL
	WHERE HOST_ID = IN_HOST_ID
	;
	
	IF V_HOST_ID_CNT = 0 THEN									-- 그 값이 0이면 (데이터가 존재하지 않는다면)
		RAISE HOST_ID_EXCEPTION;
		
	ELSE														-- 그 값이 존재한다면
		UPDATE HOST_TBL											-- 호스트테이블에 IN_HOST_ID값을 HOST_ID로 가지는 데이터를 업데이트
		SET HOST_NUM = IN_HOST_NUM, HOST_NAME = IN_HOST_NAME
		WHERE HOST_ID = IN_HOST_ID
		;
	END IF;
	
	EXCEPTION
	WHEN HOST_ID_EXCEPTION THEN
	O_ERRCODE := 'ERROR-001';
	O_ERRMSG := '호스트ID가 존재하지 않습니다.';
	
	WHEN OTHERS THEN
	O_ERRCODE := SQLCODE;
	O_ERRMSG := SQLERRM;
	ROLLBACK;
	
  END PROC_UP_HOST;


  PROCEDURE PROC_DEL_HOST(
	IN_HOST_ID			IN		VARCHAR2				-- 호스트 아이디
	,O_ERRCODE			OUT		VARCHAR2
	,O_ERRMSG			OUT		VARCHAR2
  ) AS
  
	V_CNT_HOST_ID		NUMBER(1);						-- 호스트 아이디 존재 여부 체크
	HOST_ID_EXCEPTION	EXCEPTION;
  
  BEGIN
    
	SELECT COUNT(HOST_ID)								-- 호스트가 존재하는 지 체크
	INTO V_CNT_HOST_ID									
	FROM HOST_TBL 
	;
	
	IF V_CNT_HOST_ID = 0 THEN
		RAISE HOST_ID_EXCEPTION;
	
	ELSE 
		DELETE FROM HOST_TBL							-- IN_HOST_ID를 HOST_ID로 가지는 데이터를 삭제한다.
		WHERE HOST_ID = IN_HOST_ID;
		
	END IF;
	
	EXCEPTION
	WHEN HOST_ID_EXCEPTION THEN
	O_ERRCODE := 'ERROR-001';
	O_ERRMSG := '호스트ID가 존재하지 않습니다.';
	
	WHEN OTHERS THEN
	O_ERRCODE := SQLCODE;
	O_ERRMSG := SQLERRM;
	ROLLBACK;
	
  END PROC_DEL_HOST;

END PKG_HOST;